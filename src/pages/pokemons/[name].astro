---
import type { GetStaticPaths } from 'astro';
import MainLayout from '@/layout/MainLayout.astro';
import PokemonCard from '@/components/pokemons/PokemonCard.astro';
import type { PokemonListResponse } from '@/interfaces/pokemon-list.response';

export const getStaticPaths = (async () => {
	const resp = await fetch('https://pokeapi.co/api/v2/pokemon?limit=151');
	const { results } = (await resp.json()) as PokemonListResponse;

	return results.map(({ name, url }) => ({
		params: { name: name },
		props: { name: name, url: url },
	}));
}) satisfies GetStaticPaths;

const { name } = Astro.params;
const { url } = Astro.props;

const firstChar = name.at(0);
const restChars = name.substring(1, name.length);
const pokemonNameCapitalize = `${firstChar?.toLocaleUpperCase()}${restChars}`;

const pokemonId = url.split('/').at(-2);
const pokemonNumber = pokemonId!.toString().padStart(4, '0');
const image = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${pokemonId}.png`;
const audioSrc = `https://raw.githubusercontent.com/PokeAPI/cries/main/cries/pokemon/latest/${pokemonId}.ogg`;
---

<MainLayout
	title={`Pokémon #${pokemonNumber} ${pokemonNameCapitalize}`}
	description={`Información sobre el Pokémon ${pokemonNameCapitalize}`}
	image={image}
>
	<section class='mx-10 mt-10 flex flex-col items-center justify-center'>
		<a href='/'>Regresar</a>
		<h1 class='my-3 text-center text-7xl'>{pokemonNameCapitalize}</h1>
		<PokemonCard
			name={name}
			url={url}
			isBig
		/>

		<audio
			controls
			class='my-5'
		>
			<source
				src={audioSrc}
				type='audio/ogg'
			/>
			Your browser does not support the audio element.
		</audio>
	</section>
</MainLayout>

<style>
	a {
		@apply my-6 rounded-xl bg-gray-950 px-4 py-2 text-blue-500 transition-colors duration-300 hover:text-blue-300 hover:underline;
	}
</style>
